kind: html
group: template
version: v1
namespace: post
name: layout
meta:
  live: true
render:
  imports:
  - name: collectionList
    selector: html/template/v1/collection/list
  - name: topics
    selector: website/page/v1/collection/topics
  - name: eras
    selector: website/page/v1/collection/eras
  importsDynamic:
  - name: relatedTopics
    selector: website/page/v1/topic/*
    matchIfRelatedToContext: true
  - name: relatedEras
    selector: website/page/v1/era/*
    matchIfRelatedToContext: true
  - name: relatedPosts
    selector: website/page/v1/post/*
    matchExpression:
    - operator: InSameMonthAsContext
    - operator: OnSameDayAsContext
body: |-
  {{ yield }}
  {{ if relatedTopics }}
    <h2><a href="{{ topics.HrefCanonical }}">Topics</a></h2>
    <ul>{{ collectionList relatedTopics }}</ul>
  {{ end }}
  {{ if relatedEras }}
    <h2><a href="{{ eras.HrefCanonical }}">Eras</a></h2>
    <ul>{{ collectionList relatedEras }}</ul>
  {{ end }}
  {{ if relatedPosts }}
    <h2>In Years Past and Future</h2>
    <ul>
    {{ range $post := relatedPosts }}
      <li><a href="{{ $post.HrefCanonical }}">{{ $post.Meta.PublishAt.Year }} - {{ $post.Title }}</a></li>
    {{ end }}
    </ul>
  {{ end }}